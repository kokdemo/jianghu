<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>江湖</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/flat-ui.css" rel="stylesheet">
    <style>
        html {
            height: 100%;
        }

        body {
            height: 100%;
        }

        #story {
            padding-top: 25vh;
        }
        #story .title{
            text-align: center;
        }
        #main {
            position: relative;
            height: 100%;
        }

        #panel {
            height: 100%;
        }

        #info {
            display: block;
            position: absolute;
            bottom: 0;
            left: 15px;
            right: 15px;
            height: 200px;
            overflow-y: scroll;
        }
    </style>
</head>
<body>
<div id="story" class="container center-block" v-show="!start">
    <h5 class="title">江湖</h5>
    <form class="form-horizontal">
        <div class="form-group">
            <label for="inputName" class="col-sm-2 col-sm-offset-2 control-label">名称</label>

            <div class="col-sm-4">
                <input type="text" class="form-control" id="inputName" placeholder="大家怎么称呼你" v-model="man.name">
            </div>
        </div>
        <div class="form-group">
            <label for="infoFrom" class="col-sm-2 col-sm-offset-2 control-label">你来自</label>
            <div class="col-sm-6">
                <label class="radio-inline">
                    <input type="radio" name="inlineRadioOptions" id="inlineRadio1" value="north" v-model="man.from"> 西北边塞
                </label>
                <label class="radio-inline">
                    <input type="radio" name="inlineRadioOptions" id="inlineRadio2" value="option2" disabled> 梁山脚下（未完成）
                </label>
                <label class="radio-inline">
                    <input type="radio" name="inlineRadioOptions" id="inlineRadio3" value="option3" disabled> 江南水乡（未完成）
                </label>
            </div>
        </div>

    </form>
    <div class="form-group">
        <div class="center-block" style="width: 135px">
            <button class="btn btn-success" v-on:click="startGame()" >天下风云出我辈</button>
        </div>
    </div>
</div>
<div id="main" class="container-fluid" v-show="start">
    <div id="panel" class="row">
        <div id="man" class="col-xs-3">
            <div class="panel panel-info">
                <div class="panel-heading">侠客信息</div>
                <div class="panel-body">
                    <ul class="list-group">
                        <li class="list-group-item man-name">
                            名字
                            <span class="" v-text="man.name"></span>
                        </li>
                        <li class="list-group-item man-age">
                            年龄
                            <span class="" v-text="man.age"></span>
                        </li>
                        <li class="list-group-item man-force">
                            武力
                            <span class="" v-text="(man.force.base+man.force.add).toFixed(2)"></span>
                        </li>
                        <li class="list-group-item man-body">
                            体力
                            <span class="" v-text="(man.body.base+man.body.add).toFixed(2)"></span>
                        </li>
                        <li class="list-group-item man-mind">
                            悟性
                            <span class="" v-text="(man.mind.base+man.mind.add).toFixed(2)"></span>
                        </li>
                        <li class="list-group-item man-prestige">
                            声望
                            <a class="" data-toggle="tooltip" data-placement="right"
                               title="{{man.prestige.num.toFixed(2)}}">{{man.prestige.level}}</a>
                        </li>
                        <li class="list-group-item man-martial">
                            门派
                            <a class="" data-toggle="tooltip" data-placement="right" title="{{man.martial.level}}">{{man.martial.name}}</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="choose" class="col-xs-9">
            <ul class="nav nav-tabs">
                <li role="presentation" v-on:click="switchTab(0)" v-bind:class="{'active':switchTabs==0}"><a>修身</a></li>
                <li role="presentation" v-on:click="switchTab(1)" v-bind:class="{'active':switchTabs==1}"><a>齐家</a></li>
                <li role="presentation" class="pull-right">
                    <a>
                        今年是公元{{1100+(time-time%12)/12}}年 {{time%12+1}}月
                    </a>
                </li>
            </ul>
            <template v-if="switchTabs==0">
                <div class="panel panel-info">
                    <div v-for="kongfu in man.kongfu" class="panel-body">
                        <div style="overflow: auto;zoom: 1;">
                            <span v-text="kongfu.name"></span>
                            <button class="pull-right btn btn-info" v-on:click="learn(kongfu.name)">
                                学习{{(kongfu.proficiency).toFixed(2)}}/{{kongfu.base}}
                            </button>
                            <br>
                            <span>描述：{{kongfu.describe}}</span>

                        </div>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar"
                                 aria-valuenow="{{(kongfu.proficiency)%1*100}}" aria-valuemin="0"
                                 aria-valuemax="100" v-bind:style="{width:(kongfu.proficiency)%1*100+'%'}">
                                {{(kongfu.proficiency*100).toFixed(2)+'%'}}
                            </div>
                        </div>
                    </div>
                </div>
            </template>
            <template v-if="switchTabs==1">
                <div class="panel panel-info">
                    <div v-for="mart in martial" class="panel-body">
                        <div style="overflow: auto;zoom: 1;">
                            <span v-text="mart.name"></span>
                            <button class="pull-right btn btn-info" v-if="man.martial.name == '无'"
                                    v-on:click="joinMartial(mart.name)">
                                加入{{mart.name}}
                            </button>
                            <br>
                            <span>描述：{{mart.describe}}</span>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>
    <div id="info" class="panel panel-info">
        <div class="panel-body">
            <p v-for="info in radio">{{info}}</p>
        </div>
    </div>
</div>


<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/flat-ui.min.js"></script>
<script src="vue.js"></script>
<script>
    var jianghu = new Vue({
        el: 'body',
        data: {
            start: false,
            prestige: [
                {num: 0, level: '无名小虾'},
                {num: 10, level: '义气少年'},
                {num: 1000, level: '新进侠客'},
                {num: 100000, level: '一方大侠'},
                {num: 10000000, level: '一代宗师'}
            ],
            man: {
                name: '',
                from: '',
                age: 15,
                force: {base: 5, add: 0},
                body: {base: 5, add: 0},
                mind: {base: 75, add: 0},
                prestige: {num: 0, level: '无名小虾'},
                achievement: [],
                kongfu: [
                    {
                        name: '基本拳脚',
                        type: 'force',
                        describe: '大概是和附近的小流氓打架学会的',
                        base: 5,
                        stage: [1, 0.7, 0.3, 0.1, 0.01],
                        proficiency: 0
                    },
                    {
                        name: '慢跑',
                        type: 'body',
                        describe: '大概是被小流氓追杀学会的',
                        stage: [1, 0.7, 0.3, 0.1, 0.01],
                        base: 5,
                        proficiency: 0
                    },
                    {
                        name: '三字经',
                        type: 'mind',
                        describe: '大概是附近的街道上捡到的',
                        stage: [1, 0.7, 0.1, 0.05, 0],
                        base: 5,
                        proficiency: 0
                    }
                ],
                martial: {
                    name: '无',
                    level: ''
                }
            },
            martial: [
                {
                    name: '嵩山少林寺',
                    describe: '后魏孝文帝时期，达摩大师在嵩山面壁9年，终成少林武术，之后这间古刹的风雨，就不为人所知了。',
                    force: 1000,
                    money: {
                        deposit: 10000,
                        income: 0
                    },
                    prestige: 1500,
                    levelInfo: [
                        {
                            name: '沙弥',
                            force: 5,
                            cost: 15
                        },
                        {
                            name: '罗汉堂弟子',
                            force: 20,
                            cost: 100
                        },
                        {
                            name: '般若堂弟子',
                            force: 100,
                            cost: 600
                        },
                        {
                            name: '达摩院执事',
                            force: 600,
                            cost: 4000
                        },
                        {
                            name: '戒律院首座',
                            force: 4200,
                            cost: 30000
                        },
                        {
                            name: '少林寺方丈',
                            force: 8000,
                            cost: 35000
                        }
                    ],
                    kongfu: [
                        {
                            name: '少林长拳',
                            type: 'force',
                            describe: '少林基础入门的拳术，更注重强身健体',
                            stage: [1, 0.6, 0.1, 0.05, 0],
                            base: 10,
                            proficiency: 0
                        }
                    ]
                }
            ],
            radio: [
                '公元1100年，年轻的赵煦主政7年，还在努力的推广新法，希望能缓解朝廷中的三冗问题，减轻农民的负担。',
                '正月，赵煦突然患病，不日离世。大臣们为他定下"哲宗"的谥号。同月，他那位文采卓绝的弟弟赵佶登基，即宋徽宗。',
                '苍茫北顾，同样的完颜阿骨打跟随着自己的哥哥在草原上打猎，心中却想着辽国那位昏庸的皇帝耶律洪基。',
                '江湖波澜又起，不知是哪位大侠横空出世。'
            ],
            time: 1,
            switchTabs: 0
        },
        created: function () {
            // 初始化时间
            this.time = 0
        },
        ready: function () {
            //初始化组件
            $('[data-toggle="tooltip"]').tooltip()
        },
        methods: {
            //开始游戏
            startGame:function(){
                if(this.man.name && this.man.from ){
                    this.start = true;
                    console.info('start');
                }else{
                    alert('身为大侠，总得有个清楚的身世吧');
                }
            },
            //在底部通知栏输出信息
            print: function (text) {
                this.radio.unshift(text);
            },
            //更新时间,计算年龄
            calcAge: function (x) {
                if (x > 0) {
                    this.time = this.time + x;
                }
                var year = Math.floor(this.time / 12);
                var age = 15 + year;
                if (age != this.man.age) {
                    this.print('小虾又长大了一岁')
                }
                this.man.age = age;
            },
            //计算武力，体力，悟性
            calcNum: function () {
                //每个属性分为基础和提升两部分，所有的武功都算作提升，有一些特殊事件会改变基础的部分
                var add = {force: 0, body: 0, mind: 0};
                for (var i = 0, length = this.man.kongfu.length; i < length; i++) {
                    var kf = this.man.kongfu[i];
                    add[kf.type] += kf.proficiency * kf.base;
                }
                this.man.force.add = add.force;
                this.man.body.add = add.body;
                this.man.mind.add = add.mind;
                //年龄修正部分先不弄了
            },
            //更新主角的个人声望，每次声望改变的时候调用
            calcPrestige: function (x) {
                var prestige = this.man.prestige;
                if (x) {
                    prestige.num = prestige.num + x;
                    for (var i = 0, length = this.prestige.length; i < length; i++) {
                        var level = this.prestige[i];
                        if (prestige > level.num) {
                            prestige.level = level.level;
                        }
                    }
                }
            },
            //更新主角的门派等级，目前暂定是武力值
            calcMartialLevel: function () {
                var martial = this.man.martial;
                for (var i = 0, length = martial.levelInfo.length; i < length; i++) {
                    if (this.man.force.base + this.man.force.add >= martial.levelInfo[i].force) {
                        this.man.martial.level = martial.levelInfo[i].name;
                    }
                }
            },
            //学习技能
            learn: function (name) {
                var mind = this.man.mind.base + this.man.mind.add;
                for (var i = 0, length = this.man.kongfu.length; i < length; i++) {
                    if (name === this.man.kongfu[i].name) {
                        var kf = this.man.kongfu[i];
                        var prof = kf.proficiency;
                        var stage = Math.floor(prof / 0.5);
                        this.man.kongfu[i].proficiency += mind * kf.stage[stage] / 100 / kf.base;
                        break;
                    }
                }
                this.choose(1);
            },
            joinMartial: function (name) {
                //加入门派
                var martial = this.man.martial;
                if (martial.name == '无') {
                    for (var i = 0, length = this.martial.length; i < length; i++) {
                        if (name == this.martial[i].name) {
                            var myMartial = this.martial[i];
                            this.man.martial.name = name;
                            this.man.martial.levelInfo = myMartial.levelInfo;
                            this.calcMartialLevel();
                            this.man.kongfu = this.man.kongfu.concat(myMartial.kongfu);
                            break;
                        }
                    }
                }
                this.print(this.man.name + '加入了' + this.man.martial.name + '，成为了一位' + this.man.martial.level);
                this.calcAge(1);
            },
            choose: function (x) {
                this.calcAge(x);
                this.calcNum();
            },
            switchTab: function (x) {
                this.switchTabs = x;
            }
        }
    });
</script>
</body>
</html>